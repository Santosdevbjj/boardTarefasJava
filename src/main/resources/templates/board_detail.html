<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="'Board - ' + ${board.name}">Board Detalhes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">

    <h1 th:text="${board.name}">Nome do Board</h1>

    <a th:href="@{/boards}" class="btn btn-secondary mb-3">Voltar</a>

    <h3>Colunas</h3>
    <a th:href="@{/boards/{boardId}/columns/new(boardId=${board.id})}" class="btn btn-primary mb-3">Adicionar Coluna</a>

    <div class="row">
        <div class="col-md-4" th:each="column : ${board.columns}">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 th:text="${column.name}">Nome da Coluna</h5>
                </div>
                <div class="card-body">
                    

                    <li class="list-group-item" th:each="task : ${column.tasks}">
    <strong th:text="${task.title}">Título da Task</strong><br>
    <small th:text="${task.description}">Descrição da Task</small><br>
    <small>Status: <span th:text="${task.status}"></span></small><br>
    <a th:href="@{/boards/tasks/{taskId}/move(taskId=${task.id})}" class="btn btn-sm btn-warning mt-2">Mover</a>
</li>




                <li class="list-group-item" th:each="task : ${column.tasks}">
    <strong th:text="${task.title}">Título da Task</strong><br>
    <small th:text="${task.description}">Descrição da Task</small><br>
    <small>Status: <span th:text="${task.status}"></span></small>
    <div class="mt-2">
        <!-- botão mover já existente -->
        <a th:href="@{/boards/tasks/{taskId}/move(taskId=${task.id})}" class="btn btn-sm btn-warning">Mover</a>

        <!-- mostrar botão de bloquear ou desbloquear conforme estado -->
        <form th:if="${!task.blocked}" th:action="@{/boards/tasks/{taskId}/block(taskId=${task.id})}" method="post" style="display:inline-block;">
            <input type="hidden" name="reason" value="Bloqueado via UI">
            <button type="submit" class="btn btn-sm btn-danger">Bloquear</button>
        </form>

        <form th:if="${task.blocked}" th:action="@{/boards/tasks/{taskId}/unblock(taskId=${task.id})}" method="post" style="display:inline-block;">
            <input type="hidden" name="reason" value="Desbloqueado via UI">
            <button type="submit" class="btn btn-sm btn-success">Desbloquear</button>
        </form>

        <!-- link para o histórico -->
        <a th:href="@{/boards/tasks/{taskId}/history(taskId=${task.id})}" class="btn btn-sm btn-secondary">Histórico</a>
    </div>
</li>    




<li class="list-group-item" th:each="task : ${column.tasks}">
    <strong th:text="${task.title}"></strong><br>
    <small th:text="${task.description}"></small><br>
    <small>Status: <span th:text="${task.status}"></span></small><br>

    <!-- Botão para Bloquear -->
    <button type="button" class="btn btn-sm btn-danger mt-2"
            th:if="${task.blockReason == null}"
            onclick="openBlockModal([[${task.id}]], 'block')"
            data-bs-toggle="modal" data-bs-target="#blockModal">
        Bloquear
    </button>

    <!-- Botão para Desbloquear -->
    <button type="button" class="btn btn-sm btn-success mt-2"
            th:if="${task.blockReason != null}"
            onclick="openBlockModal([[${task.id}]], 'unblock')"
            data-bs-toggle="modal" data-bs-target="#blockModal">
        Desbloquear
    </button>
</li>

                    

                        
                    </ul>
                </div>
            </div>
        </div>
    </div>

</body>
</html>


<!-- Modal de Bloqueio/Desbloqueio -->
<div class="modal fade" id="blockModal" tabindex="-1" aria-labelledby="blockModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form th:action="@{/boards/tasks/block}" method="post">
        <div class="modal-header">
          <h5 class="modal-title" id="blockModalLabel">Alterar Status da Tarefa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">

          <!-- ID da Tarefa (hidden) -->
          <input type="hidden" name="taskId" id="modalTaskId">

          <!-- Ação: bloquear ou desbloquear -->
          <input type="hidden" name="actionType" id="modalActionType">

          <div class="mb-3">
            <label for="reason" class="form-label">Motivo</label>
            <textarea id="reason" name="reason" class="form-control" rows="3" required></textarea>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Confirmar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Função para abrir o modal com dados
  function openBlockModal(taskId, actionType) {
    document.getElementById("modalTaskId").value = taskId;
    document.getElementById("modalActionType").value = actionType;
    document.getElementById("blockModalLabel").innerText = 
        (actionType === "block") ? "Bloquear Tarefa" : "Desbloquear Tarefa";
  }
</script>





